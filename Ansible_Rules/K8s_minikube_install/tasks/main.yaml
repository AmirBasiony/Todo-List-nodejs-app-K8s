- name: Install curl and apt-transport-https
  apt:
    name:
      - curl
      - apt-transport-https
    state: present
    update_cache: yes

# ------------------ kubectl Installation ------------------

- name: Get latest stable kubectl version
  shell: "curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt"
  register: kubectl_version
  changed_when: false

- name: Download kubectl binary
  get_url:
    url: "https://storage.googleapis.com/kubernetes-release/release/{{ kubectl_version.stdout }}/bin/linux/amd64/kubectl"
    dest: /usr/local/bin/kubectl
    mode: '0755'

- name: Verify kubectl version
  command: kubectl version --client
  register: kubectl_version_output
  changed_when: false

- name: Print kubectl version
  debug:
    var: kubectl_version_output.stdout

# ------------------ Minikube Installation ------------------

- name: Download Minikube binary
  get_url:
    url: https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64
    dest: /usr/local/bin/minikube
    mode: '0755'

- name: Ensure Minikube is executable
  file:
    path: /usr/local/bin/minikube
    mode: '0755'
    owner: root
    group: root

- name: Verify Minikube version
  command: minikube version
  register: minikube_version_output
  changed_when: false

- name: Print Minikube version
  debug:
    var: minikube_version_output.stdout

# ------------------ Start Minikube ------------------

- name: Start Minikube with Docker driver
  shell: "minikube start --driver=docker"
  args:
    executable: /bin/bash
